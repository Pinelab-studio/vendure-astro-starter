---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navigation from "../../components/Navigation.astro";
import Hero from "../../components/Hero.astro";
import { ProductCard } from "../../components/ProductCard";
import CollectionCard from "../../components/CollectionCard.astro";
import Footer from "../../components/Footer.astro";
import { getNavigationCollections } from "../../server/collection-service";
import { getPopularProducts } from "../../server/product-service";

const collections = await getNavigationCollections(Astro.locals.locale);
const products = await getPopularProducts(Astro.locals.locale);
---

<BaseLayout title="Astro", metaTitle="Astro", metaDescription="Astro">
  <Navigation />

  <Hero
    image="https://images.unsplash.com/photo-1556695736-d287caebc48e?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
    title="New arrivals are here"
    description="The new arrivals have, well, newly arrived. Check out the latest options from our summer small-batch release while they're still in stock."
    buttonText="Shop New Arrivals"
    buttonHref="#"
  />

  <main>
    <!-- Product section -->
    <section
      aria-labelledby="product-heading"
      class="mx-auto max-w-xl px-4 sm:px-6 lg:max-w-7xl lg:px-8 my-20"
    >
      <h2 id="category-heading" class="text-2xl font-bold tracking-tight">
        Popular products
      </h2>

      <div class="mt-10 grid grid-cols-2 gap-4 lg:grid-cols-4 lg:gap-8">

        {[...products, ...products].map((product) => (
          // FIXME, duplicated because we only have 2 products
          <ProductCard client:load
            slug={product.slug}
            image={product.featuredAsset?.preview ?? ""}
            title={product.name}
            price={product.variants[0].priceWithTax}
            variants={product.variants}
          />
        ))}
        
      </div>
    </section>

    <!-- Collection section -->
    <section
      aria-labelledby="collection-heading"
      class="mx-auto max-w-xl px-4 sm:px-6 lg:max-w-7xl lg:px-8 my-20"
    >
      <h2 id="collection-heading" class="text-2xl font-bold tracking-tight">
        Shop by Collection
      </h2>
      <p class="mt-4 text-base opacity-70">
        Each season, we collaborate with world-class designers to create a
        collection inspired by the natural world.
      </p>

      <div class="mt-10 grid gap-4 lg:grid-cols-3 lg:gap-8">
        {collections.map((collection) => (
          <CollectionCard
            href={`/c/${collection.slug}`}
            image={`${collection.featuredAsset?.preview}?preset=small&format=webp`}
            title={collection.name}
            description={collection.description}
          />
        ))}
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>
